<h2>{{ selectedInvoice ? "Update/View Invoice" : "Create Invoice" }}</h2>

<form [formGroup]="invoiceForm">

    <!-- Display user info if selectedInvoice exists -->
  <!-- <div class="form-row" *ngIf="selectedInvoice">
    <mat-form-field class="form-field">
      <mat-label>First Name</mat-label>
      <input matInput [value]="invoiceForm.get('client')?.value?.firstName" [readonly]="true">
    </mat-form-field>

    <mat-form-field class="form-field">
      <mat-label>Last Name</mat-label>
      <input matInput [value]="invoiceForm.get('client')?.value?.lastName" [readonly]="true">
    </mat-form-field>
  </div> -->

  <!-- Select a client for new invoice -->
  <div class="form-row custom-form-row" *ngIf="!selectedInvoice">
    <mat-form-field class="form-field custom-form-field">
      <mat-label>Client</mat-label>
      <mat-select formControlName="client">
        <mat-option *ngFor="let user of users" [value]="user">{{ user.firstName }}</mat-option>
      </mat-select>
    </mat-form-field>
  </div>

<ng-container  *ngIf="hasInvoiceItems()">
  <div formArrayName="invoiceItems">
    <ng-container *ngFor="let itemGroup of invoiceItemsFormArray.controls; let i = index">
      <mat-card class="item-card" [formGroup]="getFormGroup(itemGroup)">
        <mat-card-header>
          <!-- <mat-card-title>Invoice Item {{ i + 1 }}</mat-card-title> -->
          <button mat-icon-button (click)="removeTreatment(i)">
            <mat-icon>delete</mat-icon>
          </button>
          <p *ngIf="getFormGroup(itemGroup)?.get('item')">
            <b>Treatment: </b>{{ getFormGroup(itemGroup).get('item')?.value.name }}
            <br/><b>Description: </b>{{ getFormGroup(itemGroup).get('item')?.value.description }}
          </p>
        </mat-card-header>

        <!-- <ng-container *ngFor="let itemOfInvoiceItemGroup of itemOfInvoiceItemsFormArray.controls; let i = index">
            <ng-container [formGroup]="getItemFormGroup(itemOfInvoiceItemGroup)">
                <mat-form-field class="form-field">
                    <mat-label>Item Name</mat-label>
                    <input matInput formControlName="name" required>
                  </mat-form-field>
            </ng-container>
        </ng-container> -->

        <mat-card-content>
          <!-- <mat-form-field class="form-field custom-input-number">
            <mat-label>Subtotal</mat-label>
            <input matInput [value]="getFormGroup(itemGroup).get('item')?.value.price" readonly>
          </mat-form-field> -->
          <mat-form-field class="form-field custom-input-number">
            <mat-label>Subtotal</mat-label>
            <input matInput formControlName="subtotal" type="number">
          </mat-form-field>

          <mat-form-field class="form-field custom-input-number">
            <mat-label>Extra</mat-label>
            <input matInput formControlName="extra" type="number">
          </mat-form-field>

          <mat-form-field class="form-field custom-input-number">
            <mat-label>Discount</mat-label>
            <input matInput formControlName="discount" type="number">
          </mat-form-field>

          <mat-form-field class="form-field custom-input-number">
            <mat-label>Total</mat-label>
            <input matInput formControlName="total" type="number" required>
          </mat-form-field>

          <mat-form-field class="form-field custom-form-field">
            <mat-label>Observation</mat-label>
            <input matInput formControlName="observation">
          </mat-form-field>
        </mat-card-content>
      </mat-card>
    </ng-container>
  </div>
</ng-container>

<ng-container *ngIf="!selectedInvoice">
  <div class="form-row" >
    <!-- Display total and observation fields when creating a new invoice -->
    <mat-form-field class="form-field" appearance="outline">
      <mat-label>Total</mat-label>
      <input matInput formControlName="total" type="number" readonly>
      <!-- <input matInput placeholder="Total" formControlName="total" required> -->
    </mat-form-field>

    <mat-form-field class="form-field" appearance="outline">
      <mat-label>Observation</mat-label>
      <input matInput placeholder="Observation" formControlName="observation">
    </mat-form-field>
  </div>
</ng-container>

  <div class="button-group">
    <!-- Your other buttons ... -->
    <button mat-raised-button color="primary" [disabled]="invoiceForm.invalid" (click)="emitAction()">
      {{ actionButtonLabel }}
    </button>

    <button mat-raised-button color="warn" (click)="clear()">
      Clear
    </button>
  </div>

</form>
